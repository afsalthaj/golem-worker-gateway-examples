id: html-example
draft: true
version: "0.0.37"
routes:
  - method: Post
    path: /v37/{user-id}/add-item
    binding:
       type: wit-worker
       componentId:
         componentId: 3c448def-c38b-4c4f-8033-9d4671486794
         version: 0
       workerName: |
          let user: u64 = request.path.user-id;
          "my-worker-${user}"
       response: |
         let user: u64 = request.path.user-id; 
         golem:it/api.{add-item}(request.body);
         {
            headers: {
              Content-Type: "application/json"
            },
            status: 200u64,
            body: "Item added to cart successfully"
         }
  - method: Get
    path: /v37/{user-id}/get-cart-contents
    security: afsalthaj28
    binding:
      type: wit-worker
      componentId:
        componentId: 3c448def-c38b-4c4f-8033-9d4671486794
        version: 0
      workerName: |
        let user: u64 = request.path.user-id;
        "my-worker-${user}"
      response: |
        let style = "font-family: Arial, sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #1e3c72, #2a5298); color: #ffffff; text-align: center; padding: 20px;"; 
        let button_style = "color: #dcdcdc; background: none; border: 2px solid #dcdcdc; border-radius: 5px; cursor: pointer;";
        let user: u64 = request.path.user-id; 
        let email: string = request.auth.email;
        let name: string = request.auth.name;
        let picture: string = request.auth.picture;
        let content = "text/html";
        let status: u64 = 200;
        let result = golem:it/api.{get-cart-contents}();
        
        let product_names = for product in result {
          yield product.name;
        };
        
        let concatenated = reduce z, a in product_names from "" {
            let r = if z == "" then "<p> ${a} </p>" else "${z} <p> ${a} </p>";
            yield r;
          };
        
        let body = "
          <!DOCTYPE html>
          <html>
            <head>
            </head>
            <body style='${style}'>
              <div>
                <h1>Welcome to Golem Shopping Cart!</h1>
                <p style='font-size: 1.5em;'>Hello ${name}!!</p>
                <p> UserId: ${user}</p>
                <p> Email: ${email}</p>
                <img src='${picture}' alt='profile-picture' style='border-radius: 50%; width: 100px; height: 100px;'>
                <h2>Items in your cart:</h2>
                ${concatenated}
                <button style='${button_style}'>
                  Click to purchase
                </button>
              </div>
            </body>
          </html>
        ";
        
        {
          Content-Type: content,
          status: status,
          body: body
        }
